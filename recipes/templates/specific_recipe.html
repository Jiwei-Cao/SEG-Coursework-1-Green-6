{% extends 'base_content.html' %} 
{% block content %}
<div class="container my-3 mt-5 d-flex justify-content-center">
  <div class="card mb-3 specific_recipe_card">
    <div class="row g-0">
      <div class="col-md-4">
        <img
          src="{{recipe.img.url}}"
          class="img-fluid rounded-start specific-recipe-card-image"
          alt="{{recipe.title}}"
        />
      </div>
      <div class="col-md-8">
        <div class="card-body d-flex flex-column pb-3">
          <div
            class="card-title d-flex justify-content-between align-items-center mb-2"
          >
            <h4 class="card-title mb-0">{{recipe.title}}</h4>
            <span
              class="d-flex align-items-center gap-2 badge bg-light text-dark recipe-author"
            >
              <small>Author:</small>
              <img src="{{ user.gravatar }}" class="rounded-circle" />
              {{recipe.user}} {% if recipe.user == user %} (YOU) {% endif %}
            </span>
          </div>

          <p class="card-text fst-italic">{{recipe.description}}</p>

          <p class="card-text rating">
            <span class="fw-bold">Rating: </span>
            {% for _ in full_stars %}
            <i class="bi bi-star-fill full"></i>
            {% endfor %} {% if half_star %}
            <i class="bi bi-star-half half"></i>
            {% endif %} {% for _ in empty_stars %}
            <i class="bi bi-star"></i>
            {% endfor %} {{average_rating}} from {{rating_count}} rating(s)
          </p>

          <h6 class="fw-bold">Ingredients:</h6>
          <p class="mb-3">{{recipe.ingredients}}</p>

          <h6 class="fw-bold">Method:</h6>
          <p class="mb-3">{{recipe.method}}</p>

          {% if recipe.user != user %}
          <span class="fw-bold small">Your Rating:</span>
          <div class="d-flex flex-column flex-md-row gap-3 mb-2">
            <form method="post" class="rating-form">
              {% csrf_token %}
              <input type="hidden" name="form_type" value="rating_form" />
              <input
                type="hidden"
                name="recipe_clicked"
                value="{{ recipe.id }}"
              />
              <div class="star-rating d-flex flex-md-row gap-2">
                <div class="d-flex gap-2 mr-3">
                  {% for i in "54321" %} <input type="radio" id="star{{ i }}"
                  name="rating" value="{{ i }}" 
                  {% if user_rating|stringformat:"i" == i %} checked
                  {% endif %} />
                  <label for="star{{ i }}" title="{{ i }} stars">
                    <i class="bi bi-star-fill"></i>
                  </label>
                  {% endfor %}
                </div>
                <button type="submit" class="btn submit-button">
                  Submit Rating
                </button>
              </div>
            </form>
          </div>
          <div class="comment mb-3 d-flex flex-md-row gap-3"></div>
            <form action="{% url 'get_recipe' recipe.pk %}" method="post" class="flex-grow-1">
              {% csrf_token %}
              <input type="hidden" name="form_type" value="comment_form" />
              {% include 'partials/bootstrap_form.html' with form=form %}
              <button type="submit" class="btn submit-button">
                Submit Comment
              </button>
            </form>
          {% endif %}
          </div>

          <div class="d-flex justify-content-center mt-auto">
            <a href="{% url 'all_recipes' %}" class="btn link-button mb-3"
              >Back to Recipes</a
            >
          </div>
        </div>
      </div>
      <!--<div class="col-md-4">
        <div class="card-body d-flex flex-column pb-3">
          <div
            class="card-title d-flex justify-content-between align-items-center mb-2"
          >
            <h6 class="card-title mb-0">Comments</h6>

      
          </div>

          <div class="comment-container">
            {% for comment in comments %}
              {% if comment.recipe == recipe %}
              <div class="card" >
                <div class="card-body">
                  <span class="d-flex align-items-center gap-2 badge bg-light text-dark recipe-author">
                    {% with user=comment.user%}
                    <img src="{{ user.gravatar }}"class="rounded-circle" />
                    {% endwith %}
                      {{comment.user}} {% if comment.user == user %} (YOU) {% endif %}
                    
                  </span>
                  
                  <small class="card-subtitle mb-2 text-body-secondary">{{comment.date_published}}</small>
                  <p class="card-text">{{comment.comment}}</p>
                  {% if comment.user == user %} 
                    <form action="{% url 'get_recipe' recipe.pk %}" method="post">
                      {% csrf_token %}
                      <input type="hidden" name="form_type" value="delete_comment_form">
                      <input type="hidden" name="comment_clicked" value="{{comment.id}}">
                      <button class="btn btn-sm submit-button" type='submit'>Delete</button>
                    </form>
                  {% endif %}
                </div>
              </div>
              {% endif %}
            {% endfor %}
          </div>

        </div>

      </div>-->
    </div>
  </div>
</div>
<div class="container my-4 text-center mt-2">
  <button
    class="btn btn-outline-secondary mb-3"
    type="button"
    data-bs-toggle="collapse"
    data-bs-target="#commentCollapse"
  >
    Show Comments ({{ comments|length }})
  </button>

  <div class="collapse" id="commentCollapse">
    {% if comments|length == 0 %}
    <p class="text-muted text-center">
      No comments yet. {%if recipe.user != user %}Be the first to comment! 
      {% endif %}
    </p>
    {% else %}
    <div class="d-flex justify-content-center mt-3" >
      <div class="card p-3" style="width: 80%">
        {% for comment in comments %}
        <div class="border-bottom py-2">
            <div class="d-flex justify-content-between align-items-center mb-2">

              <span
              class="d-flex align-items-center gap-2 badge bg-light text-dark recipe-author"
            >
              <img src="{{ comment.user.gravatar }}" class="rounded-circle" />
              {{comment.user}} {% if recipe.user == user %} (YOU) {% endif %}
            </span>
              <small class="text-body-secondary"
                >{{comment.date_published}}</small
              >
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <p class="mb-0">{{ comment.comment }}</p>

              {% if comment.user == user %}
              <form action="{% url 'get_recipe' recipe.pk %}" method="post">
                {% csrf_token %}
                <input
                  type="hidden"
                  name="form_type"
                  value="delete_comment_form"
                />
                <input
                  type="hidden"
                  name="comment_clicked"
                  value="{{comment.id}}"
                />
                <button class="btn btn-sm btn-danger delete-button">Delete</button>
              </form>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
  {% endblock %}
</div>
