{% extends 'base_content.html' %} {% load widget_tweaks %} {% block content %}
<div class="container mb-3">

  <!--Render the form to add a new method step-->
  <h2>Add a method to your recipe: {{ recipe }}</h2>

  <div class="method-form mb-4">
    <form action="{% url 'add_method' recipe.pk %}" method="post">
      {% csrf_token %} {% for field in form %}
      <div class="mb-3">
        <label class="form-label" for="{{ field.id_for_label }}"
          >{{ field.label }}</label >

        {% if form.is_bound %} 
        {% if field.errors %} 
        {% render_field field class="form-control is-invalid" %} 
        {% else %} 
        {% render_field field class="form-control is-valid" %} 
        {% endif %} 
        {% else %} 
        {% render_field field class="form-control" %} 
        {% endif %} 
        {% if field.help_text %}
        <div class="form-text">{{ field.help_text }}</div>
        {% endif %}

        <div class="invalid-feedback">{{ field.errors }}</div>
      </div>
      {% endfor %}

      <button class="btn btn-sm submit-button" type="submit">
        Add Step
      </button>
    </form>
    <br>
      <a href="{% url 'manage_recipe_ingredient' recipe.pk %}" class="btn link-button mb-3"
            >Add ingredients</a>
    <br />
    <a href="{% url 'get_recipe' recipe.pk %}" class="btn link-button mb-3"
      >View Recipe</a
    >
  </div>

  <hr />

  <!--Display the method steps created for the recipe so far-->
  <div class="added-methods">
    <h4>Added Methods</h4>
    {% for step in recipe.method_steps.all %}
    <div class="card mb-2 container">

      <div class="card-body p-2 d-flex justify-content-between align-items-center">
        <h6 class="card-title mb-1">{{ step.step_number }}. {{ step.method_text }}</h6>
        <div class=" d-flex align-items-center">
            <button class="btn btn-sm btn-danger " type="submit" data-bs-toggle="modal" data-bs-target="#delete-method-step{{step.pk}}"> Delete </button>
            <a href="{% url 'edit_method_step' recipe.pk step.pk %}" class="link btn-sm"><button class="btn btn-sm edit-button">Edit</button></a>
        </div>
      </div>
    </div>

      <!-- Modal to delete a method step -->
      <div class="modal fade" id="delete-method-step{{step.pk}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">Delete Method Step: {{ step.step_number }}. {{ step.method_text }}</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              Are you sure you'd like to permanently delete this method step?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn  btn-sm btn-secondary" data-bs-dismiss="modal">Close</button>
              <form action="{% url 'delete_method_step' recipe.pk step.pk %}"  method="post" class="ms-2">
                {% csrf_token %}
                <button class="btn btn-sm btn-danger" type="submit" > Delete </button>
              </form>
            </div>
          </div>
        </div>
      </div>



    {% endfor %}
  </div>

  {% endblock %}

