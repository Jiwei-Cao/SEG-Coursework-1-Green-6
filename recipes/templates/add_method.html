{% extends 'base_content.html' %} {% load widget_tweaks %} {% block content %}
<div class="container mb-3">
  <h2>Add a method to your recipe: {{ recipe }}</h2>

  <div class="method-form mb-4">
    <form action="{% url 'add_method' recipe.pk %}" method="post">
      {% csrf_token %} {% for field in form %}
      <div class="mb-3">
        <label class="form-label" for="{{ field.id_for_label }}"
          >{{ field.label }}</label
        >

        {% if form.is_bound %} 
        {% if field.errors %} 
        {% render_field field class="form-control is-invalid" %} 
        {% else %} 
        {% render_field field class="form-control is-valid" %} 
        {% endif %} 
        {% else %} 
        {% render_field field class="form-control" %} 
        {% endif %} 
        {% if field.help_text %}
        <div class="form-text">{{ field.help_text }}</div>
        {% endif %}

        <div class="invalid-feedback">{{ field.errors }}</div>
      </div>
      {% endfor %}

      <button
        class="btn btn-sm submit-button"
        type="submit"
        name="operation"
        value="add_step"
      >
        Add Step
      </button>
    </form>
    <br>
      <a href="{% url 'manage_recipe_ingredient' recipe.pk %}" class="btn link-button mb-3"
            >Add ingredients</a>
    <br />
    <a href="{% url 'get_recipe' recipe.pk %}" class="btn link-button mb-3"
      >View Recipe</a
    >
  </div>

  <hr />
  <div class="added-methods">
    <h4>Added Methods</h4>
    {% for step in recipe.method_steps.all %}
    <div class="card mb-2 container">
      <div
        class="card-body p-2 d-flex justify-content-between align-items-start"
      >
        <h5 class="card-title mb-1">{{ step.step_number }}. Method Step</h5>
        <form
          action="{% url 'add_method' recipe.pk %}"
          method="post"
          class="ms-2"
        >
          {% csrf_token %}
          <input type="hidden" name="step_clicked" value="{{ step.id }}" />
          <button
            class="btn btn-sm btn-danger"
            type="submit"
            name="operation"
            value="delete_step"
          >
            Delete
          </button>
          <button type="submit" class="btn btn-sm btn-primary" name="operation" value="edit_step">Edit</button>
        </form>
      </div>
      <div class="card-body p-2 pt-0">
        <p class="card-text mb-0">{{ step.method_text }}</p>
      </div>
    </div>

    {% endfor %}
  </div>

  {% endblock %}

